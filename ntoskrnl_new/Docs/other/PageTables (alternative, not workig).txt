

Full linear address space is 36 bit VPN + 12 bit offset
Highest process address = 0xffffffffffff
0000000000000000000001111111111111111111111111101111111111111111 0x000007FFFFFEFFFF highest user address
0000000000000000011111111111111111111111111111111111111111111111 0x00007FFFFFFFFFFF highest process address
1111111111111111100000000000000000000000000000000000000000000000 0xFFFF800000000000 lowest kernel
ssssssssssssssssxxxxxxxxxpppppppppdddddddddtttttttttoooooooooooo

Size of the Full page table map is 2^36 * sizeof(VMMPTE) = 2^36 * 8 = 0x8000000000
Page table start address = 0x1000000000000 - 0x4000000000 = 0xFFC000000000
PXE_BASE is 0x800000000000 - 0x1000 = 0x7FFFFFFFF000
Size of PPE space is 0x200 * 0x1000 = 0x200000
PPE_BASE = 0x800000000000 - 0x100000 = 0x7FFFFFF00000
Size of PDE space is 0x200 * 0x200 * 0x1000 = 0x40000000
PDE_BASE = 0x800000000000 - 0x20000000 = 0x7FFFE0000000
Size of PTE space is 0x200 * 0x200 * 0x200 * 0x1000 = 0x8000000000
PTE_BASE = 0x800000000000 - 0x8000000000 = 0x7F8000000000

PXE_SELFMAP:
ssssssssssssssssxxxxxxxxxpppppppppdddddddddtttttttttoooooooooooo
0000000000000000011111111011111111011111111011111111011111111000 7FBFDFEFF7F8
PXI_SELFMAP = 0xFF
PXE_BASE                                 = 0x7FBFDFEFF000
 0x1FEFF * 8 = 0xFF7F8
PPE_BASE = 0x7FBFDFEFF7F8 - 0xFF7F8      = 0x7FBFDFE00000
 0x3FDFEFF ? 8 = 0x1FEFF7F8
PDE_BASE = 0x7FBFDFEFF7F8 - 0x1FEFF7F8   = 0x7FBFC0000000
 0x7FBFDFEFF * 8 = 0x3FDFEFF7F8
PTE_BASE = 0x7FBFDFEFF7F8 - 0x3FDFEFF7F8 = 0x7F8000000000

1111111111111111100000000000000000000000000000000000000000000000 
ssssssssssssssssxxxxxxxxxpppppppppdddddddddtttttttttoooooooooooo

THIS ONE:!!!
  1111111111111111100000000000000000000000000000000000000000000000 FFFF800000000000 lowest kernel
>> 27
= 1111111111111111111111111111111111111111111100000000000000000000
& 1111111111111111000000000000000000000000000111111111111111111000 FFFF0000001FFFF8
= 1111111111111111000000000000000000000000000100000000000000000000 
+ 0000000000000000011111111011111111011111111000000000000000000000 7FBFDFE00000 PPE_BASE
= 1111111111111111011111111011111111011111111100000000000000000000 FFFF7FBFDFF00000


PTE-> 
0000000000000000011111111111111111111111111111111111000 3FFFFFFFF8 + 7F8000000000 = 7FBFFFFFFFF8
0000000000000000011111111111111111111111111000  1FFFFFF8 + 7FFFE0000000 = 7FFFFFFFFFF8
0000000000000000011111111111111111000 
0000000000000000011111111000

AddressToPxe

(LONG64)Address >> 39
<< 3

(LONG64)Address & 0xFFFFFF8000000000 // 1111111111111111111111111000000000000000000000000000000000000000
1111111111111111100000000000000000000000000000000000000000000000 
>> 36
1111111111111111111111111111111111111111111111111111100000000000
FFFFFFFFFFFFF800

  ssssssssssssssssxxxxxxxxxpppppppppdddddddddtttttttttoooooooooooo
  11111111111111111???????????????????????????????????????????????
>> 36
= 11111111111111111111111111111111111111111111111111111???????????
& 1111111111111111100000000000000000000000000000000000011111111000
= 11111111111111111000000000000000000000000000000000000????????000
+ 0000000000000000111111111111111111111111111111111111000000000000
= 0000000000000000011111111111111111111111111111111111000000000000 7FFFFFFFF000


  1111111111111111100000000000000000000000000000000000000000000000 7FFFFFFFF000


ssssssssssssssssxxxxxxxxxpppppppppdddddddddtttttttttoooooooooooo
1111111111111111100000000000000000000000000000000000000000000000 lowest kernel
0000000000000000000000000000000000000000000011111111111111111000

  1111111111111111100000000000000000000000000011111111111111111000
+ 0000000000000000111111111111111111111111111111111111000000000000
------------------------------------------------------------------------
  1111111111111111100000000000000000000000000000000000000000000000 FFFF800000000000 lowest kernel
>> 36
= 0000000000000000000000000000000000001111111111111111100000000000
& 0000000000000000000000000000000000000000000000000000111111111000
= 0000000000000000000000000000000000000000000000000000100000000000 800 PXE_OFFSET
+ 0000000000000000011111111111111111111111111111111111000000000000 00007FFFFFFFF000 PXE_BASE
= 0000000000000000011111111111111111111111111111111111100000000000 00007FFFFFFFF800


  1111111111111111100000000000000000000000000000000000000000000000 FFFF800000000000 lowest kernel
>> 27
= 0000000000000000000000000001111111111111111100000000000000000000
& 0000000000000000000000000000000000000000000111111111111111111000
= 0000000000000000000000000000000000000000000100000000000000000000 100000 PPE offset
+ 0000000000000000011111111111111111111111111100000000000000000000 7FFFFFF00000
= 0000000000000000100000000000000000000000000000000000000000000000 800000000000

  1111111111111111100000000000000000000000000000000000000000000000 FFFF800000000000 lowest kernel
>> 11
= 0000000000011111111111111111000000000000000000000000000000000000
& 0000000000000000000000000001111111111111111110000000000000000000
= 0000000000000000000000000001000000000000000000000000000000000000 100000 PPE offset
+ 0111111111111111111111111111000000000000000000000000000000000000 7FFFFFF00000
= 1000000000000000000000000000000000000000000000000000000000000000 800000000000
>> 16

-----------------------------------------------------------------
THIS ONE:!!!
  1111111111111111100000000000000000000000000000000000000000000000 FFFF800000000000 lowest kernel
>> 27
= 1111111111111111111111111111111111111111111100000000000000000000
& 1111111111111111000000000000000000000000000111111111111111111000 FFFF0000001FFFF8
= 1111111111111111000000000000000000000000000100000000000000000000 
+ 0000000000000000011111111111111111111111111100000000000000000000 7FFFFFF00000 PPE_BASE
= 1111111111111111100000000000000000000000000000000000000000000000 FFFF800000000000
---------------------------------------------------------------------------


1111111111111111111111111000000000000000000000000000000000000000
1111111111111111111111111111111111000000000000000000000000000000
1111111111111111111111111111111111111111111000000000000000000000
1111111111111111111111111111111111111111111111111111000000000000

